<% if(session) { %>
<%- include('template/!head.ejs') %>

<body class="sb-nav-fixed">
<%- include('template/navbar.ejs') %>

    <div id="layoutSidenav">
    <%- include('template/sidebar.ejs') %>

        <div id="layoutSidenav_content">
            <div>
                <input type="hidden" id="input_first_name" value="<%= session.first_name %>">
                <input type="hidden" id="input_last_name" value="<%= session.last_name %>">
            </div>

            <div class="mb-3">
                <div class="container-fluid px-4">
                    <div class="container">
                        <div class="dynamic-title mt-4 mb-0 vw-80 vw-lg-50">
                            <h1 class="display-3 text-center pt-3 pb-5">Metricas</h1>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mb-5 bg-ligth-gray">
                <div class="row w-100 w-lg-90 my-3">
                    <div class="w-auto d-flex ms-2 me-lg-5 ms-lg-4 pe-lg-5">
                        <h2 class="display-6 text-center my-auto" data-time="<%= hour %>">
                            <%= s %>, <%= session.first_name %>
                        </h2>
                    </div>
                    <div class="col">
                        <div class="d-flex justify-content-end my-4 pe-5">
                            <button id="pdfGenerate" class="btn btn-download text-center d-flex flex-column mx-3">
                                <span class="w-100">
                                    <i class="fas fa-file-download fa-3x"></i>
                                </span>
                                <span class="w-100 mt-2">
                                    Descargar Reporte
                                </span>
                            </button>
                            <button id="addPanel" class="btn btn-add-panel text-center d-flex flex-column mx-3">
                                <span class="w-100">
                                    <i class="fas fa-plus fa-3x"></i>
                                </span>
                                <span class="w-100 mt-2">
                                    Agregar panel
                                </span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div>
                <div class="container-fluid px-4">
                    <div class="help-bar bg-dark text-light w-100 rounded-3">
                        <div class="d-flex justify-content-center">
                            <div class="w-80 w-md-50 text-center d-inline-flex my-2">
                                <i class="fas ms-auto me-2 my-auto fa-info-circle fa-2x blink"></i>
                                <p class="fs-5 me-auto ms-2 my-2">
                                    <span class="fw-bold me-1">Pequeño tip:</span> Si deseas comparar áreas y demás,
                                        basta con solo agregar un nuevo panel y configurar lo que quieres ver. ¡Sencillísimo!
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mb-5">
                <div class="container-fluid px-4">
                    <div id="panelContainer" class="row m-0 my-4 mx-auto justify-content-center"> <!-- Row div container for the report panels -->
                        <div class="col-12 col-lg-6 panel my-3" data-id="0">
                            <div class="shadow-lg rounded-2 buttons-container">
                                <div class="row justify-content-start">
                                    <button class="btn canvas-remove m-0 ms-5 mt-4 p-1 w-auto position-absolute">
                                        <i class="fas fa-times fa-2x pointer-event-none mx-1"></i>
                                    </button>
                                </div>
                                <div class="row justify-content-end">
                                    <button class="btn canvas-config m-0 me-5 mt-4 p-1 w-auto position-absolute h-toolt rot-20">
                                        <i class="fas fa-cog fa-2x toolt-txt pointer-event-none" data-text="Desplegar opciones para este panel"></i>
                                    </button>
                                    <div class="config-menu d-none position-absolute w-md-30 w-40 bg-light rounded-2 shadow-sm py-3 mt-6 me-5">
                                        <div class="container m-0 p-0">
                                            <div class="row">
                                                <div class="col-md-6 col-12 mx-auto my-1">
                                                    <div class="form-floating">
                                                        <select class="form-select area" id="sel-area" name="sel-area" aria-label="Selección">
                                                            <option class="are-s" value="0" selected>Personal a cargo</option>
                                                            <% for(let d in area) { %>
                                                                <option class="are" value="<%= area[d]['n'] %>"> 
                                                                    <%= area[d]['desc'] %> 
                                                                </option>
                                                            <% } %>
                                                        </select>
                                                        <label for="sel-area">Área</label>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 col-12 mx-auto my-1">
                                                    <div class="form-floating">
                                                        <select class="form-select department" id="sel-department" name="sel-department" aria-label="Selección" disabled>
                                                            <option class="dep-s" value="0" selected>-Selecciona departamento-</option>
                                                            <% for(let d in depa) { %>
                                                                <option class="dep" data-area="<%= depa[d]['area'] %>" value="<%= depa[d]['n'] %>">
                                                                    <%= depa[d]['desc'] %>
                                                                </option>
                                                            <% } %>
                                                        </select>
                                                        <label for="sel-department">Departamento</label>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 col-12 mx-auto my-1">
                                                    <div class="form-floating">
                                                        <select class="form-select career" id="sel-career" name="sel-career" aria-label="Selección" disabled>
                                                            <option class="car-s" value="0" selected>-Selecciona carrera-</option>
                                                            <% for(let d in care) { %>
                                                                <option class="car" data-depa="<%= care[d]['department'] %>" value="<%= care[d]['n'] %>">
                                                                    <%= care[d]['desc'] %>
                                                                </option>
                                                            <% } %>
                                                        </select>
                                                        <label for="sel-career">Carrera</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row px-md-2 px-xl-4 pb-3">
                                    <div class="col-12 px-md-2 px-xl-4">
                                        <div class="lienzos container">
                                            <div class="row">
                                                <div class="col-12 mt-4">
                                                    <h5 class="text-center display-6 text-uppercase canvasTitle">Personal a cargo</h5>
                                                </div>
                                            </div>
                                            <div class="row px-5 mx-3 canvas-container semiDoughnutChart">
                                                <canvas width="100%" height="100%"></canvas>
                                            </div>
                                            <div class="row canvas-container barsChart">
                                                <canvas width="100%" height="50%"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        <%- include('template/!footer.ejs') %>
        </div>
    </div>

    <%- include('template/!scripts.ejs') %>
    <script src="/js/metricas.js"></script>
    <script src="/js/pdf-generator.js"></script>
</body>

</html>
<% } else { %>
    <%- include('template/!handler.ejs') %>
<% } %>