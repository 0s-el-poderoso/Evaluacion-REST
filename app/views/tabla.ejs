<% if (session) { %>
<%- include('template/!head.ejs') %>

<body class="sb-nav-fixed">
<%- include('template/navbar.ejs') %>

    <div id="layoutSidenav">
    <%- include('template/sidebar.ejs') %>

        <div id="layoutSidenav_content">
            <main class="mb-5">
                <div class="session-container">
                    <input class="deletable" type="hidden" name="user" id="user"
                        value="<%= session.user %>">
                    <input class="deletable" type="hidden" name="name" id="name"
                        value="<%= session.name %>">
                    <input class="deletable" type="hidden" name="lvl" id="lvl"
                        value="<%= session.lvl %>">
                    
                    <input class="deletable" type="hidden" name="s-area" id="s-area"
                        value="<%= session['area'] %>">
                    <input class="deletable" type="hidden" name="s-department" id="s-department"
                        value="<%= session.department %>">
                    <input class="deletable" type="hidden" name="s-career" id="s-career"
                        value="<%= session.career %>">
                </div>

                <div class="container-fluid px-4">
                    <div class="dynamic-title">
                        <h1 class="display-1 text-center py-4">Control</h1>
                    </div>

                    <div class="container w-lg-75 w-90 mx-auto">
                        <table class="paginator table-effect border-0 table caption-top flex-table" data-rows-shown="5, 10, 15">
                            <thead>
                                <tr class="border-0 flex-th">
                                    <th class="border-0 border-bottom border-end flex-th">Usuario</th>
                                    <th class="border-0 border-bottom border-start flex-th">Nombre(s)</th>
                                    <th class="border-0 border-bottom border-start flex-th">Apellido(s)</th>
                                    <th class="border-0 border-bottom border-start flex-th">Status</th>
                                    <th class="border-0 border-bottom border-start flex-th">Acciones</th>
                                </tr>
                            </thead>
                            <tbody class="border-0" id="table-b">
                                <% if (records != false) {
                                    for(let record in records) { %>
                                    <tr id="<%= records[record]['_id'] %>" class="i-info pag-item" data-status="<%= records[record]['records'] %>">
                                        <td class="border-0 border-end text-center"><%= records[record]['_id'] %></td>
                                        <td class="border-0 border-start text-center"><%= records[record]['first_name'] %></td>
                                        <td class="border-0 border-start text-center"><%= records[record]['last_name'] %></td>
                                        <td class="border-0 border-start text-center i-status"></td>
                                        <td class="border-0 border-start d-flex justify-content-center h-100">
                                            <% if (records[record]['records'] == 0) { %>
                                                <button type="button" onclick="go('<%= records[record][`_id`] %>')"
                                                    class="btn btn-info mx-md-2 my-auto mx-1 p-1 h-toolt">
                                                    <i class="text-white fas fa-plus-circle fa-2x toolt-txt"
                                                        data-text="Realizar encuesta para <%= records[record]['first_name'] %>"></i>
                                                </button>
                                            <% } else { %>
                                                <button type="button" 
                                                    class="btn btn-success mx-md-2 my-auto mx-1 p-1 h-toolt">
                                                    <i class="text-white fas fa-chart-line fa-2x toolt-txt"
                                                        data-text="Ver registros de <%= records[record]['first_name'] %>"></i>
                                                </button>
                                            <% } %>
                                        </td>
                                    </tr>
                                <% } } else { %>
                                <td id="empty" colspan="5" class="border-0 text-center">
                                    <div class="text-center">
                                        <i class="fas fa-ghost icon-ghost f-vScreen-15 my-3 text-black-15"></i>
                                        <p class="my-2 text-ghost fs-4">No hay datos para mostrar</p>
                                    </div>
                                </td>
                                <% } %>
                            </tbody>
                        </table>
                    </div>
                </div>
            </main>

            <%- include('template/!footer.ejs') %>
        </div>
    </div>

    <%- include('template/!scripts.ejs') %>
    <script src="/js/paginator.js"></script>
</body>

</html>
<% } else { %>
    <%- include('template/!handler.ejs') %>
<% } %>
